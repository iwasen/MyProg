//*****************************************************************************************************
//  1. ファイル名
//		BaseDraw.cpp
//----------------------------------------------------------------------------------------------------
//  2. 機能
//		グラフ描画共通基底クラスの実装
//----------------------------------------------------------------------------------------------------
//  3. 備考
//----------------------------------------------------------------------------------------------------
//  4. 履歴
//		2007.08.09 S.Aizawa 新規作成
//*****************************************************************************************************

#include "StdAfx.h"
#include "BaseDraw.h"
#include <math.h>

//*****************************************************************************************************
//  1. 関数名
//		CBaseDraw::GetLinearScaleStep
//----------------------------------------------------------------------------------------------------
//  2. 機能
//		リニアスケールの目盛り線のステップを取得
//----------------------------------------------------------------------------------------------------
//  3. パラメータ説明
//		double		fRange		[I] スケールのレンジ幅（最大値と最小値の差）
//		int			nPixel		[I] スケールのピクセル数
//		int			*pStep		[O] ステップの幅
//----------------------------------------------------------------------------------------------------
//  4. 戻り値
//		double		１目盛り間のステップ値
//*****************************************************************************************************
double CBaseDraw::GetLinearScaleStep(double fRange, int nPixel, int *pStep)
{
	double t1, t2;
	int nStep;

	if (fRange <= 0)
		return 1;

	t1 = fRange / nPixel;
	double fStep = pow(10.0, floor(log10(t1)));
	t2 = t1 / fStep;
	if (t2 < 2) {
		fStep *= 0.5;
		nStep = 2;
	} else if (t2 < 5)
		nStep = 2;
	else
		nStep = 5;

	if (pStep != NULL)
		*pStep = nStep;

	return fStep;
}

//*****************************************************************************************************
//  1. 関数名
//		CBaseDraw::GetLogScaleStep
//----------------------------------------------------------------------------------------------------
//  2. 機能
//		対数スケール線の目盛り線のステップを取得
//----------------------------------------------------------------------------------------------------
//  3. パラメータ説明
//		double		fValue		[I] 現在の目盛り線の値
//----------------------------------------------------------------------------------------------------
//  4. 戻り値
//		double		１目盛り間のステップ値
//*****************************************************************************************************
double CBaseDraw::GetLogScaleStep(double fValue)
{
	return pow(10, floor(log10(fValue) + 1e-3));
}

//*****************************************************************************************************
//  1. 関数名
//		CBaseDraw::GetScaleStartValue
//----------------------------------------------------------------------------------------------------
//  2. 機能
//		最初の目盛り線の値を取得
//----------------------------------------------------------------------------------------------------
//  3. パラメータ説明
//		double		fMinValue		[I] スケールの最小値
//		double		fStep			[I] 目盛り線のステップ幅
//----------------------------------------------------------------------------------------------------
//  4. 戻り値
//		double		最初の目盛り線の値
//*****************************************************************************************************
double CBaseDraw::GetScaleStartValue(double fMinValue, double fStep)
{
	return floor(fMinValue / fStep + 1e-3) * fStep;
}
