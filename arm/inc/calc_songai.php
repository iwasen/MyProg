<?
/******************************************************
* system  : xxx リスク診断
* title   : 損害計算処理
* content : リスク診断に於ける損害関連の計算を行う
* version : 1.0
* author  : aizawa
*******************************************************/

// ■リスク診断／損害データ計算
function calc_sn_data() {
	global $g_encode, $g_const, $g_sheets;

	$n = '損害';
	$g_sheets[$n] = array();
	$s = &$g_sheets;
	$c = &$g_sheets[$n];

	// 定数
	$t = &$g_const['家財評価'];
	$r = 46;
	foreach ($t['本人'] as $key => $val) {
		$c["A$r"] = $key;
		$c["B$r"] = $val;
		$c["C$r"] = $val;
		$c["D$r"] = $t['子供'];
		$r++;
	}

	$t = &$g_const['損害係数'];
	$c['D25'] = $t['火災'];
	$c['D26'] = $t['地震'];
	$c['D27'] = $t['盗難'];
	$c['D28'] = $t['事故'];
	$c['D29'] = $t['損害賠償'];

	$c['C40'] = 10000;

	// 計算式
	$c['C33'] = VB_IF($s['基本']['C28'] == $g_encode['住宅']['持家'], VB_IF($s['損保']['G49'] == 0, ($s['基本']['C40'] * VB_VLOOKUP('基本', $s['基本']['C29'], 'N80:O83', 2, FALSE)), $s['損保']['G49']), 0);
	$c['C34'] = VB_IF($s['損保']['G51'] > 0, $s['損保']['G51'], VB_VLOOKUP($n, $s['基本']['D8'], 'A46:D49', 2, TRUE) + VB_IF($s['基本']['E8'] == "", 0, VB_VLOOKUP($n, $s['基本']['E8'], 'A46:D49', 3, TRUE)) + $s['基本']['K3'] * $c['D46']);
	$c['C35'] = $c['C33'];
	$c['C36'] = $c['C34'];
	$c['C37'] = $c['C34'];
	$c['C38'] = VB_IF(VB_AND($s['基本']['M48'] == $g_encode['運転']['運転しない'], $s['基本']['N48'] == $g_encode['運転']['運転しない']), 0, 15000);
	$c['C39'] = VB_IF(VB_AND($s['基本']['M48'] == $g_encode['運転']['運転しない'], $s['基本']['N48'] == $g_encode['運転']['運転しない']), 0, 30000);
	$c['D33'] = $s['損保']['G16'];
	$c['D34'] = $s['損保']['G18'];
	$c['D35'] = $s['損保']['G17'];
	$c['D36'] = $s['損保']['G19'];
	$c['D37'] = $c['D34'];
	$c['D38'] = $s['損保']['G21'];
	$c['D39'] = $s['損保']['G22'];
	$c['D40'] = $s['損保']['G27'] + $s['生保']['I233'] + $s['生保']['I108'];
	$c['E33'] = $c['D33'] / $c['C33'];
	$c['E34'] = $c['D34'] / $c['C34'];
	$c['E35'] = $c['D35'] / $c['C35'];
	$c['E36'] = $c['D36'] / $c['C36'];
	$c['E37'] = $c['D37'] / $c['C37'];
	$c['E38'] = VB_IF($c['C38'] == 0, 0, $c['D38'] / $c['C38']);
	$c['E39'] = VB_IF($c['C39'] == 0, 0, $c['D39'] / $c['C39']);
	$c['E40'] = $c['D40'] / $c['C40'];
	$c['F25'] = $c['C33'] + $c['C34'];
	$c['F26'] = $c['C35'] + $c['C36'];
	$c['F27'] = $c['C37'];
	$c['F28'] = $c['C38'] + $c['C39'];
	$c['F29'] = $c['C40'];
	$c['F30'] = VB_SUM3($n, 'F25:F29', 'D25:D29');
	$c['G25'] = $c['D33'] + $c['D34'];
	$c['G26'] = $c['D35'] + $c['D36'];
	$c['G27'] = $c['D37'];
	$c['G28'] = $c['D38'] + $c['D39'];
	$c['G29'] = $c['D40'];
	$c['G30'] = VB_MIN($n, 'F25:G25') * $c['D25'] + VB_MIN($n, 'F26:G26') * $c['D26'] + VB_MIN($n, 'F27:G27') * $c['D27'] + VB_MIN($n, 'F28:G28') * $c['D28'] + VB_MIN($n, 'F29:G29') * $c['D29'];
	$c['B25'] = 100;
	$c['B26'] = 100;
	$c['B27'] = 100;
	$c['B28'] = VB_IF($c['F28'] == 0, 0, 100);
	$c['B29'] = 100;
	$c['B30'] = 100;
	$c['C25'] = $c['G25'] / $c['F25'] * 100;
	$c['C26'] = $c['G26'] / $c['F26'] * 100;
	$c['C27'] = $c['G27'] / $c['F27'] * 100;
	$c['C28'] = VB_IF($c['F28'] == 0, 0, $c['G28'] / $c['F28'] * 100);
	$c['C29'] = $c['G29'] / $c['F29'] * 100;
	$c['C30'] = $c['G30'] / $c['F30'] * 100;
	$c['L5'] = $c['F25'];
	$c['L6'] = $c['G25'];
	$c['L7'] = $c['L6'] / $c['L5'];
	$c['L8'] = $c['F26'];
	$c['L9'] = $c['G26'];
	$c['L10'] = $c['L9'] / $c['L8'];
	$c['L11'] = $c['F27'];
	$c['L12'] = $c['G27'];
	$c['L13'] = $c['L12'] / $c['L11'];
	$c['L14'] = $c['C38'];
	$c['L15'] = $c['C39'];
	$c['L16'] = $c['D38'];
	$c['L17'] = $c['D39'];
	$c['L18'] = VB_IF($c['L14'] == 0, 0, $c['L16'] / $c['L14']);
	$c['L19'] = VB_IF($c['L15'] == 0, 0, $c['L17'] / $c['L15']);
	$c['L20'] = $c['F29'];
	$c['L21'] = $s['損保']['G27'];
	$c['L22'] = $c['L21'] / $c['L20'];
}
?>