<?
/******************************************************
* system  : xxx リスク診断
* title   : 医療計算処理
* content : リスク診断に於ける医療関連の計算を行う
* version : 1.0
* author  : aizawa
*******************************************************/

// ■リスク診断／医療データ計算
function calc_ir_data() {
	global $g_encode, $g_const, $g_sheets;

	$n = '医療';
	$g_sheets[$n] = array();
	$s = &$g_sheets;
	$c = &$g_sheets[$n];

	// 定数
	$t = &$g_const['病気別平均'];
	$c['H55'] = $t['病気']['入院患者数'];
	$c['I55'] = $t['病気']['平均日数'];
	$c['H56'] = $t['けが']['入院患者数'];
	$c['I56'] = $t['けが']['平均日数'];
	$c['H57'] = $t['脳卒中']['入院患者数'];
	$c['I57'] = $t['脳卒中']['平均日数'];
	$c['H58'] = $t['がん']['入院患者数'];
	$c['I58'] = $t['がん']['平均日数'];
	$c['H59'] = $t['心筋梗塞']['入院患者数'];
	$c['I59'] = $t['心筋梗塞']['平均日数'];
	$c['H60'] = $t['糖尿病']['入院患者数'];
	$c['I60'] = $t['糖尿病']['平均日数'];
	$c['H62'] = 0;

	$c['A64'] = 1;
	$c['A65'] = 2;
	$c['A66'] = 3;
	$c['B64'] = $g_const['差額ベッド代'][1];
	$c['B65'] = $g_const['差額ベッド代'][2];
	$c['B66'] = $g_const['差額ベッド代'][3];
	$c['B62'] = VB_VLOOKUP($n, $s['基本']['C66'], 'A64:B66', 2, FALSE);

	$t = &$g_const['病気別平均'];
	$c['B37'] = $t['病気']['診療費'];
	$c['B38'] = $t['けが']['診療費'];
	$c['B39'] = $t['脳卒中']['診療費'];
	$c['B40'] = $t['がん']['診療費'];
	$c['B41'] = $t['心筋梗塞']['診療費'];
	$c['B42'] = $t['糖尿病']['診療費'];
	$c['C37'] = $c['B37'] * $c['I55'];
	$c['C38'] = $c['B38'] * $c['I56'];
	$c['C39'] = $c['B39'] * $c['I57'];
	$c['C40'] = $c['B40'] * $c['I58'];
	$c['C41'] = $c['B41'] * $c['I59'];
	$c['C42'] = $c['B42'] * $c['I60'];
	$c['D37'] = $c['I55'] * (0.1 + $c['B62']);
	$c['D38'] = $c['I56'] * (0.1 + $c['B62']);
	$c['D39'] = $c['I57'] * (0.8 + $c['B62']);
	$c['D40'] = $c['I58'] * (1 + $c['B62']);
	$c['D41'] = $c['I59'] * ($c['B62'] + 0.8);
	$c['D42'] = $c['I60'] * (0.8 + $c['B62']);
	$c['E37'] = $s['会社']['D15'] * $c['C37'];
	$c['E38'] = $s['会社']['D15'] * $c['C38'];
	$c['E39'] = $s['会社']['D15'] * $c['C39'];
	$c['E40'] = $s['会社']['D15'] * $c['C40'];
	$c['E41'] = $s['会社']['D15'] * $c['C41'];
	$c['E42'] = $s['会社']['D15'] * $c['C42'];
	$c['F37'] = ($s['会社']['D18'] * $c['I55']) * 0.0001;
	$c['F38'] = ($s['会社']['D18'] * $c['I56']) * 0.0001;
	$c['F39'] = ($s['会社']['D18'] * $c['I57']) * 0.0001;
	$c['F40'] = ($s['会社']['D18'] * $c['I58']) * 0.0001;
	$c['F41'] = ($s['会社']['D18'] * $c['I59']) * 0.0001;
	$c['F42'] = ($s['会社']['D18'] * $c['I60']) * 0.0001;
	$c['G37'] = $s['会社']['D15'] * $c['C37'];
	$c['G38'] = $s['会社']['D15'] * $c['C38'];
	$c['G39'] = $s['会社']['D15'] * $c['C39'];
	$c['G40'] = $s['会社']['D15'] * $c['C40'];
	$c['G41'] = $s['会社']['D15'] * $c['C41'];
	$c['G42'] = $s['会社']['D15'] * $c['C42'];
	$c['H37'] = ($s['会社']['D19'] * $c['I55']) * 0.0001;
	$c['H38'] = ($s['会社']['D19'] * $c['I56']) * 0.0001;
	$c['H39'] = ($s['会社']['D19'] * $c['I57']) * 0.0001;
	$c['H40'] = ($s['会社']['D19'] * $c['I58']) * 0.0001;
	$c['H41'] = ($s['会社']['D19'] * $c['I59']) * 0.0001;
	$c['H42'] = ($s['会社']['D19'] * $c['I60']) * 0.0001;

	// 本人
	for ($i = 1; $i <= $s['生保']['D5']; $i++) {
		$c['C70'][$i] = $s['生保']['D50'][$i];
		$c['C71'][$i] = $s['生保']['D70'][$i];
		$c['D70'][$i] = $s['生保']['D51'][$i];
		$c['D71'][$i] = $s['生保']['D71'][$i];
		$c['E70'][$i] = $s['生保']['D52'][$i];
		$c['E71'][$i] = $s['生保']['D72'][$i];
		$c['F70'][$i] = $s['生保']['D53'][$i];
		$c['F71'][$i] = $s['生保']['D73'][$i];
		$c['G70'][$i] = $s['生保']['D58'][$i] * 10000;
		$c['G71'][$i] = $s['生保']['D78'][$i] * 10000;
		$c['H70'][$i] = $s['生保']['D57'][$i] * 10000;
		$c['H71'][$i] = $s['生保']['D77'][$i] * 10000;
		$c['I70'][$i] = $s['生保']['D62'][$i];
		$c['I71'][$i] = $s['生保']['D82'][$i];
	}
	$c['C80'] = VB_SUM($n, 'C70:C71');
	$c['D80'] = VB_SUM($n, 'D70:D71');
	$c['E80'] = VB_SUM($n, 'E70:E71');
	$c['F80'] = VB_SUM($n, 'F70:F71');
	$c['G80'] = VB_SUM($n, 'G70:G71');
	$c['H80'] = VB_SUM($n, 'H70:H71');

	$c['B83'] = 1;
	$c['B84'] = 0;
	$c['B85'] = 1;
	$c['B86'] = 1;
	$c['B87'] = 1;
	$c['B88'] = 1;
	$c['C83'] = 0;
	$c['C84'] = 1;
	$c['C85'] = 0;
	$c['C86'] = 0;
	$c['C87'] = 0;
	$c['C88'] = 0;
	$c['D83'] = 0;
	$c['D84'] = 0;
	$c['D85'] = 1;
	$c['D86'] = 1;
	$c['D87'] = 1;
	$c['D88'] = 1;
	$c['E83'] = 0;
	$c['E84'] = 0;
	$c['E85'] = 0;
	$c['E86'] = 1;
	$c['E87'] = 0;
	$c['E88'] = 0;
	$c['F83'] = 0;
	$c['F84'] = 0;
	$c['F85'] = 0;
	$c['F86'] = 1;
	$c['F87'] = 0;
	$c['F88'] = 0;
	$c['G83'] = 0;
	$c['G84'] = 0;
	$c['G85'] = 1;
	$c['G86'] = 1;
	$c['G87'] = 1;
	$c['G88'] = 0;
	$c['H83'] = $c['I55'];
	$c['H84'] = $c['I56'];
	$c['H85'] = $c['I57'];
	$c['H86'] = $c['I58'];
	$c['H87'] = $c['I59'];
	$c['H88'] = $c['I60'];

	for ($i = 1; $i <= $s['生保']['D5']; $i++) {
		$c['C91'][$i] = MIN($c['H83'], $c['I70'][$i]) * VB_SUM3($n, 'B83:E83', 'C70:F70', false, $i) + VB_SUM3($n, 'G70:H70', 'F83:G83', $i);
		$c['C92'][$i] = MIN($c['H83'], $c['I71'][$i]) * VB_SUM3($n, 'B83:E83', 'C71:F71', false, $i) + VB_SUM3($n, 'G71:H71', 'F83:G83', $i);
		$c['D91'][$i] = MIN($c['H84'], $c['I70'][$i]) * VB_SUM3($n, 'B84:E84', 'C70:F70', false, $i) + VB_SUM3($n, 'G70:H70', 'F84:G84', $i);
		$c['D92'][$i] = MIN($c['H84'], $c['I71'][$i]) * VB_SUM3($n, 'B84:E84', 'C71:F71', false, $i) + VB_SUM3($n, 'G71:H71', 'F84:G84', $i);
		$c['E91'][$i] = MIN($c['H85'], $c['I70'][$i]) * VB_SUM3($n, 'B85:E85', 'C70:F70', false, $i) + VB_SUM3($n, 'G70:H70', 'F85:G85', $i);
		$c['E92'][$i] = MIN($c['H85'], $c['I71'][$i]) * VB_SUM3($n, 'B85:E85', 'C71:F71', false, $i) + VB_SUM3($n, 'G71:H71', 'F85:G85', $i);
		$c['F91'][$i] = MIN($c['H86'], $c['I70'][$i]) * VB_SUM3($n, 'B86:E86', 'C70:F70', false, $i) + VB_SUM3($n, 'G70:H70', 'F86:G86', $i);
		$c['F92'][$i] = MIN($c['H86'], $c['I71'][$i]) * VB_SUM3($n, 'B86:E86', 'C71:F71', false, $i) + VB_SUM3($n, 'G71:H71', 'F86:G86', $i);
		$c['G91'][$i] = MIN($c['H87'], $c['I70'][$i]) * VB_SUM3($n, 'B87:E87', 'C70:F70', false, $i) + VB_SUM3($n, 'G70:H70', 'F87:G87', $i);
		$c['G92'][$i] = MIN($c['H87'], $c['I71'][$i]) * VB_SUM3($n, 'B87:E87', 'C71:F71', false, $i) + VB_SUM3($n, 'G71:H71', 'F87:G87', $i);
		$c['H91'][$i] = MIN($c['H88'], $c['I70'][$i]) * VB_SUM3($n, 'B88:E88', 'C70:F70', false, $i) + VB_SUM3($n, 'G70:H70', 'F88:G88', $i);
		$c['H92'][$i] = MIN($c['H88'], $c['I71'][$i]) * VB_SUM3($n, 'B88:E88', 'C71:F71', false, $i) + VB_SUM3($n, 'G71:H71', 'F88:G88', $i);
	}

	$c['C101'] = VB_SUM($n, 'C91:C92');
	$c['D101'] = VB_SUM($n, 'D91:D92');
	$c['E101'] = VB_SUM($n, 'E91:E92');
	$c['F101'] = VB_SUM($n, 'F91:F92');
	$c['G101'] = VB_SUM($n, 'G91:G92');
	$c['H101'] = VB_SUM($n, 'H91:H92');

	$c['L46'] = VB_IF($s['基本']['F45'] > $g_const['自己負担上限額算出用定数'], 14, 7.2);
	$c['G46'] = (($c['I55'] - $c['L46'] / ($c['B37'] * 0.3)) / 30 + 1) * $c['L46'];
	$c['G47'] = (($c['I56'] - $c['L46'] / ($c['B38'] * 0.3)) / 30 + 1) * $c['L46'];
	$c['G48'] = (($c['I57'] - $c['L46'] / ($c['B39'] * 0.3)) / 30 + 1) * $c['L46'];
	$c['G49'] = (($c['I58'] - $c['L46'] / ($c['B40'] * 0.3)) / 30 + 1) * $c['L46'];
	$c['G50'] = (($c['I59'] - $c['L46'] / ($c['B41'] * 0.3)) / 30 + 1) * $c['L46'];
	$c['G51'] = (($c['I60'] - $c['L46'] / ($c['B42'] * 0.3)) / 30 + 1) * $c['L46'];

	$c['B46'] = $c['C37'] + $c['D37'];
	$c['B47'] = $c['C38'] + $c['D38'];
	$c['B48'] = $c['C39'] + $c['D39'];
	$c['B49'] = $c['C40'] + $c['D40'];
	$c['B50'] = $c['C41'] + $c['D41'];
	$c['B51'] = $c['C42'] + $c['D42'];
	$c['C46'] = $c['C37'] - $c['G46'];
	$c['C47'] = $c['C38'] - $c['G47'];
	$c['C48'] = $c['C39'] - $c['G48'];
	$c['C49'] = $c['C40'] - $c['G49'];
	$c['C50'] = $c['C41'] - $c['G50'];
	$c['C51'] = $c['C42'] - $c['G51'];
	$c['D46'] = ($c['E37'] + $c['F37']);
	$c['D47'] = ($c['E38'] + $c['F38']);
	$c['D48'] = ($c['E39'] + $c['F39']);
	$c['D49'] = ($c['E40'] + $c['F40']);
	$c['D50'] = ($c['E41'] + $c['F41']);
	$c['D51'] = ($c['E42'] + $c['F42']);
	$c['E46'] = $c['C101'] / 10000;
	$c['E47'] = $c['D101'] / 10000;
	$c['E48'] = $c['E101'] / 10000;
	$c['E49'] = $c['F101'] / 10000;
	$c['E50'] = $c['G101'] / 10000;
	$c['E51'] = $c['H101'] / 10000;
	$c['F46'] = VB_SUM($n, 'C46:E46');
	$c['F47'] = VB_SUM($n, 'C47:E47');
	$c['F48'] = VB_SUM($n, 'C48:E48');
	$c['F49'] = VB_SUM($n, 'C49:E49');
	$c['F50'] = VB_SUM($n, 'C50:E50');
	$c['F51'] = VB_SUM($n, 'C51:E51');

	$c['I46'] = $c['B46'] - $c['C46'];
	$c['I47'] = $c['B47'] - $c['C47'];
	$c['I48'] = $c['B48'] - $c['C48'];
	$c['I49'] = $c['B49'] - $c['C49'];
	$c['I50'] = $c['B50'] - $c['C50'];
	$c['I51'] = $c['B51'] - $c['C51'];
	$c['J46'] = $c['I46'] / $c['I55'];
	$c['J47'] = $c['I47'] / $c['I56'];
	$c['J48'] = $c['I48'] / $c['I57'];
	$c['J49'] = $c['I49'] / $c['I58'];
	$c['J50'] = $c['I50'] / $c['I59'];
	$c['J51'] = $c['I51'] / $c['I60'];

	$c['C55'] = ($c['C46'] / $c['B46']) * 100;
	$c['C56'] = ($c['C47'] / $c['B47']) * 100;
	$c['C57'] = ($c['C48'] / $c['B48']) * 100;
	$c['C58'] = ($c['C49'] / $c['B49']) * 100;
	$c['C59'] = ($c['C50'] / $c['B50']) * 100;
	$c['C60'] = ($c['C51'] / $c['B51']) * 100;
	$c['D55'] = (($c['D46'] / $c['B46']) * 100) + $c['C55'];
	$c['D56'] = (($c['D47'] / $c['B47']) * 100) + $c['C56'];
	$c['D57'] = (($c['D48'] / $c['B48']) * 100) + $c['C57'];
	$c['D58'] = (($c['D49'] / $c['B49']) * 100) + $c['C58'];
	$c['D59'] = (($c['D50'] / $c['B50']) * 100) + $c['C59'];
	$c['D60'] = (($c['D51'] / $c['B51']) * 100) + $c['C60'];
	$c['E55'] = (($c['E46'] / $c['B46']) * 100) + $c['D55'];
	$c['E56'] = (($c['E47'] / $c['B47']) * 100) + $c['D56'];
	$c['E57'] = (($c['E48'] / $c['B48']) * 100) + $c['D57'];
	$c['E58'] = (($c['E49'] / $c['B49']) * 100) + $c['D58'];
	$c['E59'] = (($c['E50'] / $c['B50']) * 100) + $c['D59'];
	$c['E60'] = (($c['E51'] / $c['B51']) * 100) + $c['D60'];

	$c['K4'] = $c['B46'] * 10000;
	$c['K5'] = $c['F46'] * 10000;
	$c['K6'] = $c['K5'] / $c['K4'];
	$c['K7'] = $c['B47'] * 10000;
	$c['K8'] = $c['F47'] * 10000;
	$c['K9'] = $c['K8'] / $c['K7'];
	$c['K10'] = $c['B48'] * 10000;
	$c['K11'] = $c['F48'] * 10000;
	$c['K12'] = $c['K11'] / $c['K10'];
	$c['K13'] = $c['B49'] * 10000;
	$c['K14'] = $c['F49'] * 10000;
	$c['K15'] = $c['K14'] / $c['K13'];
	$c['K16'] = $c['B50'] * 10000;
	$c['K17'] = $c['F50'] * 10000;
	$c['K18'] = $c['K17'] / $c['K16'];
	$c['K19'] = $c['B51'] * 10000;
	$c['K20'] = $c['F51'] * 10000;
	$c['K21'] = $c['K20'] / $c['K19'];
	$c['K4'] = $c['B46'] * 10000;
	$c['K5'] = $c['F46'] * 10000;
	$c['K6'] = $c['K5'] / $c['K4'];
	$c['K7'] = $c['B47'] * 10000;
	$c['K8'] = $c['F47'] * 10000;
	$c['K9'] = $c['K8'] / $c['K7'];
	$c['K10'] = $c['B48'] * 10000;
	$c['K11'] = $c['F48'] * 10000;
	$c['K12'] = $c['K11'] / $c['K10'];
	$c['K13'] = $c['B49'] * 10000;
	$c['K14'] = $c['F49'] * 10000;
	$c['K15'] = $c['K14'] / $c['K13'];
	$c['K16'] = $c['B50'] * 10000;
	$c['K17'] = $c['F50'] * 10000;
	$c['K18'] = $c['K17'] / $c['K16'];
	$c['K19'] = $c['B51'] * 10000;
	$c['K20'] = $c['F51'] * 10000;
	$c['K21'] = $c['K20'] / $c['K19'];

	// 配偶者
	for ($i = 1; $i <= $s['生保']['D139']; $i++) {
		$c['P71'][$i] = $s['生保']['D180'][$i];
		$c['P72'][$i] = $s['生保']['D194'][$i];
		$c['Q71'][$i] = $s['生保']['D181'][$i];
		$c['Q72'][$i] = $s['生保']['D195'][$i];
		$c['R71'][$i] = $s['生保']['D182'][$i];
		$c['R72'][$i] = $s['生保']['D196'][$i];
		$c['S71'][$i] = $s['生保']['D183'][$i];
		$c['S72'][$i] = $s['生保']['D197'][$i];
		$c['T71'][$i] = $s['生保']['D188'][$i] * 10000;
		$c['T72'][$i] = $s['生保']['D202'][$i] * 10000;
		$c['U71'][$i] = $s['生保']['D187'][$i] * 10000;
		$c['U72'][$i] = $s['生保']['D201'][$i] * 10000;
		$c['V71'][$i] = $s['生保']['D192'][$i];
		$c['V72'][$i] = $s['生保']['D206'][$i];
	}

	$c['P81'] = VB_SUM($n, 'P71:P72');
	$c['Q81'] = VB_SUM($n, 'Q71:Q72');
	$c['R81'] = VB_SUM($n, 'R71:R72');
	$c['S81'] = VB_SUM($n, 'S71:S72');
	$c['T81'] = VB_SUM($n, 'T71:T72');
	$c['U81'] = VB_SUM($n, 'U71:U72');

	$c['O84'] = 1;
	$c['O85'] = 0;
	$c['O86'] = 1;
	$c['O87'] = 1;
	$c['O88'] = 1;
	$c['O89'] = 1;
	$c['P84'] = 0;
	$c['P85'] = 1;
	$c['P86'] = 0;
	$c['P87'] = 0;
	$c['P88'] = 0;
	$c['P89'] = 0;
	$c['Q84'] = 0;
	$c['Q85'] = 0;
	$c['Q86'] = 1;
	$c['Q87'] = 1;
	$c['Q88'] = 1;
	$c['Q89'] = 1;
	$c['R84'] = 0;
	$c['R85'] = 0;
	$c['R86'] = 0;
	$c['R87'] = 1;
	$c['R88'] = 0;
	$c['R89'] = 0;
	$c['S84'] = 0;
	$c['S85'] = 0;
	$c['S86'] = 0;
	$c['S87'] = 1;
	$c['S88'] = 0;
	$c['S89'] = 0;
	$c['T84'] = 0;
	$c['T85'] = 0;
	$c['T86'] = 1;
	$c['T87'] = 1;
	$c['T88'] = 1;
	$c['T89'] = 0;
	$c['U84'] = $c['I55'];
	$c['U85'] = $c['I56'];
	$c['U86'] = $c['I57'];
	$c['U87'] = $c['I58'];
	$c['U88'] = $c['I59'];
	$c['U89'] = $c['I60'];

	for ($i = 1; $i <= $s['生保']['D139']; $i++) {
		$c['P92'][$i] = MIN($c['U84'], $c['V71'][$i]) * VB_SUM3($n, 'O84:R84', 'P71:S71', false, $i) + VB_SUM3($n, 'T71:U71', 'S84:T84', $i);
		$c['P93'][$i] = MIN($c['U84'], $c['V72'][$i]) * VB_SUM3($n, 'O84:R84', 'P72:S72', false, $i) + VB_SUM3($n, 'T72:U72', 'S84:T84', $i);
		$c['Q92'][$i] = MIN($c['U85'], $c['V71'][$i]) * VB_SUM3($n, 'O85:R85', 'P71:S71', false, $i) + VB_SUM3($n, 'T71:U71', 'S85:T85', $i);
		$c['Q93'][$i] = MIN($c['U85'], $c['V72'][$i]) * VB_SUM3($n, 'O85:R85', 'P72:S72', false, $i) + VB_SUM3($n, 'T72:U72', 'S85:T85', $i);
		$c['R92'][$i] = MIN($c['U86'], $c['V71'][$i]) * VB_SUM3($n, 'O86:R86', 'P71:S71', false, $i) + VB_SUM3($n, 'T71:U71', 'S86:T86', $i);
		$c['R93'][$i] = MIN($c['U86'], $c['V72'][$i]) * VB_SUM3($n, 'O86:R86', 'P72:S72', false, $i) + VB_SUM3($n, 'T72:U72', 'S86:T86', $i);
		$c['S92'][$i] = MIN($c['U87'], $c['V71'][$i]) * VB_SUM3($n, 'O87:R87', 'P71:S71', false, $i) + VB_SUM3($n, 'T71:U71', 'S87:T87', $i);
		$c['S93'][$i] = MIN($c['U87'], $c['V72'][$i]) * VB_SUM3($n, 'O87:R87', 'P72:S72', false, $i) + VB_SUM3($n, 'T72:U72', 'S87:T87', $i);
		$c['T92'][$i] = MIN($c['U88'], $c['V71'][$i]) * VB_SUM3($n, 'O88:R88', 'P71:S71', false, $i) + VB_SUM3($n, 'T71:U71', 'S88:T88', $i);
		$c['T93'][$i] = MIN($c['U88'], $c['V72'][$i]) * VB_SUM3($n, 'O88:R88', 'P72:S72', false, $i) + VB_SUM3($n, 'T72:U72', 'S88:T88', $i);
		$c['U92'][$i] = MIN($c['U89'], $c['V71'][$i]) * VB_SUM3($n, 'O89:R89', 'P71:S71', false, $i) + VB_SUM3($n, 'T71:U71', 'S89:T89', $i);
		$c['U93'][$i] = MIN($c['U89'], $c['V72'][$i]) * VB_SUM3($n, 'O89:R89', 'P72:S72', false, $i) + VB_SUM3($n, 'T72:U72', 'S89:T89', $i);
	}

	$c['P102'] = VB_SUM($n, 'P92:P93');
	$c['Q102'] = VB_SUM($n, 'Q92:Q93');
	$c['R102'] = VB_SUM($n, 'R92:R93');
	$c['S102'] = VB_SUM($n, 'S92:S93');
	$c['T102'] = VB_SUM($n, 'T92:T93');
	$c['U102'] = VB_SUM($n, 'U92:U93');

	$c['U45'] = (($c['I55'] - $c['L46'] / ($c['B37'] * 0.3)) / 30 + 1) * $c['L46'];
	$c['U46'] = (($c['I56'] - $c['L46'] / ($c['B38'] * 0.3)) / 30 + 1) * $c['L46'];
	$c['U47'] = (($c['I57'] - $c['L46'] / ($c['B39'] * 0.3)) / 30 + 1) * $c['L46'];
	$c['U48'] = (($c['I58'] - $c['L46'] / ($c['B40'] * 0.3)) / 30 + 1) * $c['L46'];
	$c['U49'] = (($c['I59'] - $c['L46'] / ($c['B41'] * 0.3)) / 30 + 1) * $c['L46'];
	$c['U50'] = (($c['I60'] - $c['L46'] / ($c['B42'] * 0.3)) / 30 + 1) * $c['L46'];

	$c['O46'] = $c['C37'] + $c['D37'];
	$c['O47'] = $c['C38'] + $c['D38'];
	$c['O48'] = $c['C39'] + $c['D39'];
	$c['O49'] = $c['C40'] + $c['D40'];
	$c['O50'] = $c['C41'] + $c['D41'];
	$c['O51'] = $c['C42'] + $c['D42'];
	$c['P46'] = $c['C37'] - $c['U45'];
	$c['P47'] = $c['C38'] - $c['U46'];
	$c['P48'] = $c['C39'] - $c['U47'];
	$c['P49'] = $c['C40'] - $c['U48'];
	$c['P50'] = $c['C41'] - $c['U49'];
	$c['P51'] = $c['C42'] - $c['U50'];
	$c['Q46'] = ($c['G37'] + $c['H37']);
	$c['Q47'] = ($c['G38'] + $c['H38']);
	$c['Q48'] = ($c['G39'] + $c['H39']);
	$c['Q49'] = ($c['G40'] + $c['H40']);
	$c['Q50'] = ($c['G41'] + $c['H41']);
	$c['Q51'] = ($c['G42'] + $c['H42']);
	$c['R46'] = $c['P102'] / 10000;
	$c['R47'] = $c['Q102'] / 10000;
	$c['R48'] = $c['R102'] / 10000;
	$c['R49'] = $c['S102'] / 10000;
	$c['R50'] = $c['T102'] / 10000;
	$c['R51'] = $c['U102'] / 10000;
	$c['S46'] = VB_SUM($n, 'P46:R46');
	$c['S47'] = VB_SUM($n, 'P47:R47');
	$c['S48'] = VB_SUM($n, 'P48:R48');
	$c['S49'] = VB_SUM($n, 'P49:R49');
	$c['S50'] = VB_SUM($n, 'P50:R50');
	$c['S51'] = VB_SUM($n, 'P51:R51');

	$c['W45'] = $c['O46'] - $c['P46'];
	$c['W46'] = $c['O47'] - $c['P47'];
	$c['W47'] = $c['O48'] - $c['P48'];
	$c['W48'] = $c['O49'] - $c['P49'];
	$c['W49'] = $c['O50'] - $c['P50'];
	$c['W50'] = $c['O51'] - $c['P51'];

	$c['X45'] = $c['W45'] / $c['I55'];
	$c['X46'] = $c['W46'] / $c['I56'];
	$c['X47'] = $c['W47'] / $c['I57'];
	$c['X48'] = $c['W48'] / $c['I58'];
	$c['X49'] = $c['W49'] / $c['I59'];
	$c['X50'] = $c['W50'] / $c['I60'];

	$c['P55'] = ($c['P46'] / $c['O46']) * 100;
	$c['P56'] = ($c['P47'] / $c['O47']) * 100;
	$c['P57'] = ($c['P48'] / $c['O48']) * 100;
	$c['P58'] = ($c['P49'] / $c['O49']) * 100;
	$c['P59'] = ($c['P50'] / $c['O50']) * 100;
	$c['P60'] = ($c['P51'] / $c['O51']) * 100;
	$c['Q55'] = (($c['Q46'] / $c['O46']) * 100) + $c['P55'];
	$c['Q56'] = (($c['Q47'] / $c['O47']) * 100) + $c['P56'];
	$c['Q57'] = (($c['Q48'] / $c['O48']) * 100) + $c['P57'];
	$c['Q58'] = (($c['Q49'] / $c['O49']) * 100) + $c['P58'];
	$c['Q59'] = (($c['Q50'] / $c['O50']) * 100) + $c['P59'];
	$c['Q60'] = (($c['Q51'] / $c['O51']) * 100) + $c['P60'];
	$c['R55'] = (($c['R46'] / $c['O46']) * 100) + $c['Q55'];
	$c['R56'] = (($c['R47'] / $c['O47']) * 100) + $c['Q56'];
	$c['R57'] = (($c['R48'] / $c['O48']) * 100) + $c['Q57'];
	$c['R58'] = (($c['R49'] / $c['O49']) * 100) + $c['Q58'];
	$c['R59'] = (($c['R50'] / $c['O50']) * 100) + $c['Q59'];
	$c['R60'] = (($c['R51'] / $c['O51']) * 100) + $c['Q60'];

	$c['X4'] = $c['O46'] * 10000;
	$c['X5'] = $c['S46'] * 10000;
	$c['X6'] = $c['X5'] / $c['X4'];
	$c['X7'] = $c['O47'] * 10000;
	$c['X8'] = $c['S47'] * 10000;
	$c['X9'] = $c['X8'] / $c['X7'];
	$c['X10'] = $c['O48'] * 10000;
	$c['X11'] = $c['S48'] * 10000;
	$c['X12'] = $c['X11'] / $c['X10'];
	$c['X13'] = $c['O49'] * 10000;
	$c['X14'] = $c['S49'] * 10000;
	$c['X15'] = $c['X14'] / $c['X13'];
	$c['X16'] = $c['O50'] * 10000;
	$c['X17'] = $c['S50'] * 10000;
	$c['X18'] = $c['X17'] / $c['X16'];
	$c['X19'] = $c['O51'] * 10000;
	$c['X20'] = $c['S51'] * 10000;
	$c['X21'] = $c['X20'] / $c['X19'];

	$c['B24'] = $c['C37'] + $c['D37'];
	$c['B25'] = $c['C38'] + $c['D38'];
	$c['B26'] = $c['C39'] + $c['D39'];
	$c['B27'] = $c['C40'] + $c['D40'];
	$c['B28'] = $c['C41'] + $c['D41'];
	$c['B29'] = $c['C42'] + $c['D42'];
	$c['C24'] = ($c['C46'] / $c['B24']) * 100;
	$c['C25'] = ($c['C47'] / $c['B25']) * 100;
	$c['C26'] = ($c['C48'] / $c['B26']) * 100;
	$c['C27'] = ($c['C49'] / $c['B27']) * 100;
	$c['C28'] = ($c['C50'] / $c['B28']) * 100;
	$c['C29'] = ($c['C51'] / $c['B29']) * 100;
	$c['C31'] = ($c['C24'] * $c['H55']) + ($c['C25'] * $c['H56']) + ($c['C26'] * $c['H57']) + ($c['C27'] * $c['H58']) + ($c['C28'] * $c['H59']) + ($c['C29'] * $c['H60']);
	$c['D24'] = ($c['D46'] / $c['B24']) * 100;
	$c['D25'] = ($c['D47'] / $c['B25']) * 100;
	$c['D26'] = ($c['D48'] / $c['B26']) * 100;
	$c['D27'] = ($c['D49'] / $c['B27']) * 100;
	$c['D28'] = ($c['D50'] / $c['B28']) * 100;
	$c['D29'] = ($c['D51'] / $c['B29']) * 100;
	$c['D31'] = ($c['D24'] * $c['H55']) + ($c['D25'] * $c['H56']) + ($c['D26'] * $c['H57']) + ($c['D27'] * $c['H58']) + ($c['D28'] * $c['H59']) + ($c['D29'] * $c['H60']);
	$c['E24'] = ($c['E46'] / $c['B24']) * 100;
	$c['E25'] = ($c['E47'] / $c['B25']) * 100;
	$c['E26'] = ($c['E48'] / $c['B26']) * 100;
	$c['E27'] = ($c['E49'] / $c['B27']) * 100;
	$c['E28'] = ($c['E50'] / $c['B28']) * 100;
	$c['E29'] = ($c['E51'] / $c['B29']) * 100;
	$c['E31'] = ($c['E24'] * $c['H55']) + ($c['E25'] * $c['H56']) + ($c['E26'] * $c['H57']) + ($c['E27'] * $c['H58']) + ($c['E28'] * $c['H59']) + ($c['E29'] * $c['H60']);
	$c['F24'] = VB_SUM($n, 'C24:E24');
	$c['F25'] = MIN(100, VB_SUM($n, 'C25:E25'));
	$c['F26'] = MIN(100, VB_SUM($n, 'C26:E26'));
	$c['F27'] = MIN(100, VB_SUM($n, 'C27:E27'));
	$c['F28'] = MIN(100, VB_SUM($n, 'C28:E28'));
	$c['F29'] = MIN(100, VB_SUM($n, 'C29:E29'));
	$c['F31'] = ($c['F24'] * $c['H55']) + ($c['F25'] * $c['H56']) + ($c['F26'] * $c['H57']) + ($c['F27'] * $c['H58']) + ($c['F28'] * $c['H59']) + ($c['F29'] * $c['H60']);
	$c['O24'] = $c['C37'] + $c['D37'];
	$c['O25'] = $c['C38'] + $c['D38'];
	$c['O26'] = $c['C39'] + $c['D39'];
	$c['O27'] = $c['C40'] + $c['D40'];
	$c['O28'] = $c['C41'] + $c['D41'];
	$c['O29'] = $c['C42'] + $c['D42'];
	$c['P24'] = ($c['P46'] / $c['O24']) * 100;
	$c['P25'] = ($c['P47'] / $c['O25']) * 100;
	$c['P26'] = ($c['P48'] / $c['O26']) * 100;
	$c['P27'] = ($c['P49'] / $c['O27']) * 100;
	$c['P28'] = ($c['P50'] / $c['O28']) * 100;
	$c['P29'] = ($c['P51'] / $c['O29']) * 100;
	$c['P30'] = 0;
	$c['P31'] = ($c['P24'] * $c['H55']) + ($c['P25'] * $c['H56']) + ($c['P26'] * $c['H57']) + ($c['P27'] * $c['H58']) + ($c['P28'] * $c['H59']) + ($c['P29'] * $c['H60']) + ($c['P30'] * $c['H62']);
	$c['Q24'] = ($c['Q46'] / $c['O24']) * 100;
	$c['Q25'] = ($c['Q47'] / $c['O25']) * 100;
	$c['Q26'] = ($c['Q48'] / $c['O26']) * 100;
	$c['Q27'] = ($c['Q49'] / $c['O27']) * 100;
	$c['Q28'] = ($c['Q50'] / $c['O28']) * 100;
	$c['Q29'] = ($c['Q51'] / $c['O29']) * 100;
	$c['Q30'] = 0;
	$c['Q31'] = ($c['Q24'] * $c['H55']) + ($c['Q25'] * $c['H56']) + ($c['Q26'] * $c['H57']) + ($c['Q27'] * $c['H58']) + ($c['Q28'] * $c['H59']) + ($c['Q29'] * $c['H60']) + ($c['Q30'] * $c['H62']);
	$c['R24'] = ($c['R46'] / $c['O24']) * 100;
	$c['R25'] = ($c['R47'] / $c['O25']) * 100;
	$c['R26'] = ($c['R48'] / $c['O26']) * 100;
	$c['R27'] = ($c['R49'] / $c['O27']) * 100;
	$c['R28'] = ($c['R50'] / $c['O28']) * 100;
	$c['R29'] = ($c['R51'] / $c['O29']) * 100;
	$c['R30'] = 0;
	$c['R31'] = ($c['R24'] * $c['H55']) + ($c['R25'] * $c['H56']) + ($c['R26'] * $c['H57']) + ($c['R27'] * $c['H58']) + ($c['R28'] * $c['H59']) + ($c['R29'] * $c['H60']) + ($c['R30'] * $c['H62']);
	$c['S24'] = MIN(100, VB_SUM($n, 'P24:R24'));
	$c['S25'] = MIN(100, VB_SUM($n, 'P25:R25'));
	$c['S26'] = MIN(100, VB_SUM($n, 'P26:R26'));
	$c['S27'] = MIN(100, VB_SUM($n, 'P27:R27'));
	$c['S28'] = MIN(100, VB_SUM($n, 'P28:R28'));
	$c['S29'] = MIN(100, VB_SUM($n, 'P29:R29'));
	$c['S30'] = 0;
	$c['S31'] = ($c['S24'] * $c['H55']) + ($c['S25'] * $c['H56']) + ($c['S26'] * $c['H57']) + ($c['S27'] * $c['H58']) + ($c['S28'] * $c['H59']) + ($c['S29'] * $c['H60']) + ($c['S30'] * $c['H62']);
}
?>