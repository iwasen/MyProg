<?
/******************************************************
* system  : xxx リスク診断
* title   : 老後計算処理
* content : リスク診断に於ける老後関連の計算を行う
* version : 1.0
* author  : aizawa
*******************************************************/

// ■リスク診断／老後データ計算
function calc_rg_data() {
	global $g_encode, $g_const, $g_sheets;

	$n = '老後';
	$g_sheets[$n] = array();
	$s = &$g_sheets;
	$c = &$g_sheets[$n];

	$c['D57'] = $s['基本']['BA2'] + VB_SUM('基本', 'BK2:BM2');
	$c['D58'] = $s['基本']['BA3'] + VB_SUM('基本', 'BK3:BM3');
	$c['E57'] = $s['基本']['BF2'] + VB_SUM('基本', 'BG2:BJ2');
	$c['E58'] = $s['基本']['BF3'] + VB_SUM('基本', 'BG3:BJ3');
	$c['F57'] = VB_SUM('基本', 'BB2');
	$c['F58'] = VB_SUM('基本', 'BB3');
	$c['G57'] = VB_SUM($n, 'D57:F57');
	$c['G58'] = VB_SUM($n, 'D58:F58');
	$c['I37'] = $s['基本']['BQ2'];
	$c['C41'] = $c['G57'];
	$c['C42'] = $c['G58'];
	$c['C43'] = VB_SUM($n, 'C41:C42');
	$c['D41'] = $s['基本']['BR2'] + $s['基本']['BS2'] + $s['基本']['BT2'] + $s['基本']['BV2'] + $s['基本']['BW2'] + $s['基本']['BX2'];
	$c['D42'] = $s['基本']['BR3'] + $s['基本']['BS3'] + $s['基本']['BT3'] + $s['基本']['BV3'] + $s['基本']['BW3'] + $s['基本']['BX3'];
	$c['D43'] = VB_SUM($n, 'D41:D42');
	$c['E41'] = $s['基本']['BU2'];
	$c['E42'] = $s['基本']['BU3'];
	$c['E43'] = VB_SUM($n, 'E41:E42');
	$c['F41'] = $s['基本']['BP2'];
	$c['F42'] = $s['基本']['BP3'];
	$c['F43'] = VB_SUM($n, 'F41:F42');
	$c['G41'] = $s['基本']['BN2'] + $s['基本']['BO2'];
	$c['G42'] = $s['基本']['BN3'] + $s['基本']['BO3'];
	$c['G43'] = VB_SUM($n, 'G41:G42');
	$c['H41'] = VB_SUM('基本', 'BY2:CP2');
	$c['H42'] = VB_SUM('基本', 'BY3:CP3');
	$c['H43'] = VB_SUM($n, 'H41:H42');
	$c['I41'] = MAX(0, MIN($c['I37'], $c['C41'] - VB_SUM($n, 'D41:H41')));
	$c['I42'] = $c['I37'] - $c['I41'] + $s['基本']['BQ3'];
	$c['I43'] = VB_SUM($n, 'I41:I42');
	$c['J41'] = VB_SUM($n, 'D41:I41');
	$c['J42'] = VB_SUM($n, 'D42:I42');
	$c['J43'] = VB_SUM($n, 'D43:I43');
	$c['K41'] = VB_SUM($n, 'D41:I41') / $c['C41'];
	$c['K42'] = VB_SUM($n, 'D42:I42') / $c['C42'];
	$c['K43'] = VB_SUM($n, 'D43:I43') / $c['C43'];
	$c['M41'] = $c['C41'] * 2 / ($c['C41'] * 2 + $c['C42']);
	$c['M42'] = $c['C42'] / ($c['C41'] * 2 + $c['C42']);
	$c['D50'] = $c['D41'];
	$c['D51'] = $c['D42'];
	$c['D52'] = VB_SUM($n, 'D50:D51');
	$c['E50'] = $c['E41'] + $c['F41'];
	$c['E51'] = $c['E42'] + $c['F42'];
	$c['E52'] = VB_SUM($n, 'E50:E51');
	$c['F50'] = $c['G41'] + $c['I41'];
	$c['F51'] = $c['G42'] + $c['I42'];
	$c['F52'] = VB_SUM($n, 'F50:F51');
	$c['G50'] = $c['H41'];
	$c['G51'] = $c['H42'];
	$c['G52'] = VB_SUM($n, 'G50:G51');
	$c['H50'] = VB_SUM($n, 'D50:G50');
	$c['H51'] = VB_SUM($n, 'D51:G51');
	$c['H52'] = VB_SUM($n, 'H50:H51');
	$c['C4'] = $c['D57'];
	$c['C5'] = $c['E57'];
	$c['C6'] = $c['F57'];
	$c['C7'] = $c['C41'];
	$c['C8'] = $c['D41'];
	$c['C9'] = $c['E41'] + $c['F41'];
	$c['C10'] = $c['G41'] + $c['I41'];
	$c['C11'] = $c['H41'];
	$c['C12'] = $c['H50'];
	$c['C13'] = VB_IF($c['C7'] > 0, $c['C12'] / $c['C7'], 0);
	$c['E4'] = $c['D58'];
	$c['E5'] = $c['E58'];
	$c['E6'] = $c['F58'];
	$c['E7'] = $c['C42'];
	$c['E8'] = $c['D42'];
	$c['E9'] = $c['E42'] + $c['F42'];
	$c['E10'] = $c['G42'] + $c['I42'];
	$c['E11'] = $c['H42'];
	$c['E12'] = $c['H51'];
	$c['E13'] = $c['E12'] / $c['E7'];
	$c['G4'] = $c['C4'] + $c['E4'];
	$c['G5'] = $c['C5'] + $c['E5'];
	$c['G6'] = $c['C6'] + $c['E6'];
	$c['G7'] = $c['C7'] + $c['E7'];
	$c['G8'] = $c['D52'];
	$c['G9'] = $c['E52'];
	$c['G10'] = $c['F52'];
	$c['G11'] = $c['G52'];
	$c['G12'] = VB_SUM($n, 'G8:G11');
	$c['G13'] = $c['G12'] / $c['G7'];

	$c['B32'] = $c['C41'];
	$c['B33'] = $c['C42'];
	$c['B34'] = $c['C43'];
	$c['C32'] = VB_IF($c['B32'] == 0, 0, $c['D41'] / $c['C41'] * 100);
	$c['C33'] = $c['D42'] / $c['C42'] * 100;
	$c['C34'] = $c['D43'] / $c['C43'] * 100;
	$c['D32'] = VB_IF($c['B32'] == 0, 0, VB_SUM($n, 'E41:F41') / $c['C41'] * 100);
	$c['D33'] = VB_SUM($n, 'E42:F42') / $c['C42'] * 100;
	$c['D34'] = VB_SUM($n, 'E43:F43') / $c['C43'] * 100;
	$c['E32'] = VB_IF($c['B32'] == 0, 0, ($c['G41'] + $c['I41']) / $c['C41'] * 100);
	$c['E33'] = ($c['G42'] + $c['I42']) / $c['C42'] * 100;
	$c['E34'] = ($c['G43'] + $c['I43']) / $c['C43'] * 100;
	$c['F32'] = VB_IF($c['B32'] == 0, 0, $c['H41'] / $c['C41'] * 100);
	$c['F33'] = $c['H42'] / $c['C42'] * 100;
	$c['F34'] = $c['H43'] / $c['C43'] * 100;
	$c['G32'] = VB_SUM($n, 'C32:F32');
	$c['G33'] = VB_SUM($n, 'C33:F33');
	$c['G34'] = VB_SUM($n, 'C34:F34');

	$c['D45'] = VB_IF($c['K42'] > 1, MAX(0, 1 - ($c['J43'] - $c['D43']) / $c['C43']), $c['D43'] / $c['J43']);
	$c['D46'] = VB_IF($c['K42'] > 1, MAX(0, 1 - ($c['J43'] - $c['G43']) / $c['C43']), $c['G43'] / $c['J43']);
	$c['L16'] = -($c['G7'] - $c['G12']);

	$c['C26'] = $c['D45'];
	$c['C27'] = $c['D46'];
	$c['J26'] = VB_IF($c['L16'] > 0, 0, ($c['C43'] - $c['J43']) / 300);
	$c['J27'] = MAX(0, VB_IF($c['L16'] > 0, 0, -$c['L16'] / (60 - $s['基本']['D8'])));
}
?>