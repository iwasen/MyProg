//*****************************************************************************************************
//  1. ファイル名
//		SubMenu.cpp
//----------------------------------------------------------------------------------------------------
//  2. 機能
//		CSubMenu クラスのインプリメンテーション
//----------------------------------------------------------------------------------------------------
//  3. 備考
//----------------------------------------------------------------------------------------------------
//  4. 履歴
//		2006.09.01 S.Aizawa(xxx) 新規作成
//*****************************************************************************************************

#include "stdafx.h"
#include "WorkScheduler.h"
#include "SubMenu.h"

#ifdef _DEBUG
#define new DEBUG_NEW
#undef THIS_FILE
static char THIS_FILE[] = __FILE__;
#endif

//*****************************************************************************************************
//  1. 関数名
//		CSubMenu::CSubMenu
//----------------------------------------------------------------------------------------------------
//  2. 機能
//		コンストラクタ
//----------------------------------------------------------------------------------------------------
//  3. パラメータ説明
//		無し
//----------------------------------------------------------------------------------------------------
//  4. 戻り値
//		無し
//----------------------------------------------------------------------------------------------------
//  5. 処理概要
//		無し
//----------------------------------------------------------------------------------------------------
//  6. 備考
//----------------------------------------------------------------------------------------------------
//  7. 履歴
//		2006.09.01 S.Aizawa(xxx) 新規作成
//*****************************************************************************************************
CSubMenu::CSubMenu()
{
	m_pDialog = NULL;
}

//*****************************************************************************************************
//  1. 関数名
//		CSubMenu::~CSubMenu
//----------------------------------------------------------------------------------------------------
//  2. 機能
//		デストラクタ
//----------------------------------------------------------------------------------------------------
//  3. パラメータ説明
//		無し
//----------------------------------------------------------------------------------------------------
//  4. 戻り値
//		無し
//----------------------------------------------------------------------------------------------------
//  5. 処理概要
//		全サブメニューを削除する。
//----------------------------------------------------------------------------------------------------
//  6. 備考
//----------------------------------------------------------------------------------------------------
//  7. 履歴
//		2006.09.01 S.Aizawa(xxx) 新規作成
//*****************************************************************************************************
CSubMenu::~CSubMenu()
{
	// 全サブメニューを削除
	DeleteAll();
}


BEGIN_MESSAGE_MAP(CSubMenu, CStatic)
	//{{AFX_MSG_MAP(CSubMenu)
		// メモ - ClassWizard はこの位置にマッピング用のマクロを追加または削除します。
	//}}AFX_MSG_MAP
END_MESSAGE_MAP()

//*****************************************************************************************************
//  1. 関数名
//		CSubMenu::Add
//----------------------------------------------------------------------------------------------------
//  2. 機能
//		サブメニューを追加
//----------------------------------------------------------------------------------------------------
//  3. パラメータ説明
//		CSubMenuDlg		*pDialog			[I] サブメニューに追加するダイアログ
//		UINT		nTemplateID			[I] ダイアログのテンプレートID
//----------------------------------------------------------------------------------------------------
//  4. 戻り値
//		無し
//----------------------------------------------------------------------------------------------------
//  5. 処理概要
//		指定されたダイアログをサブメニューの位置に作成する。
//----------------------------------------------------------------------------------------------------
//  6. 備考
//----------------------------------------------------------------------------------------------------
//  7. 履歴
//		2006.09.01 S.Aizawa(xxx) 新規作成
//*****************************************************************************************************
void CSubMenu::Add(CSubMenuDlg *pDialog, UINT nTemplateID)
{
	CWnd *pParent = GetParent();

	// ダイアログウィンドウを作成する
	pDialog->Create(nTemplateID, pParent);

	// サブメニューに位置に表示する
	CRect rect;
	GetWindowRect(rect);
	pParent->ScreenToClient(rect);
	pDialog->SetWindowPos(NULL, rect.left, rect.top, 0, 0, SWP_NOSIZE | SWP_NOZORDER);

	// サブメニューダイアログ配列に追加する
	m_arrayDialog.Add(pDialog);
}

//*****************************************************************************************************
//  1. 関数名
//		CSubMenu::Show
//----------------------------------------------------------------------------------------------------
//  2. 機能
//		指定されたサブメニューを表示
//----------------------------------------------------------------------------------------------------
//  3. パラメータ説明
//		int		nIndex			[I] サブメニューダイアログのインデックス
//----------------------------------------------------------------------------------------------------
//  4. 戻り値
//		無し
//----------------------------------------------------------------------------------------------------
//  5. 処理概要
//		指定されたダイアログをサブメニューの位置に表示する。
//----------------------------------------------------------------------------------------------------
//  6. 備考
//----------------------------------------------------------------------------------------------------
//  7. 履歴
//		2006.09.01 S.Aizawa(xxx) 新規作成
//*****************************************************************************************************
void CSubMenu::Show(int nIndex)
{
	int nItem = m_arrayDialog.GetSize();

	// 全ダイアログを非表示にする
	for (int i = 0; i < nItem; i++) {
		CSubMenuDlg *pDialog = (CSubMenuDlg *)m_arrayDialog[i];
		pDialog->ShowWindow(SW_HIDE);
	}

	// 指定されたダイアログを表示する
	if (nIndex >= 0 && nIndex < nItem) {
		m_pDialog = (CSubMenuDlg *)m_arrayDialog[nIndex];
		m_pDialog->ShowWindow(SW_SHOW);
	}
}

//*****************************************************************************************************
//  1. 関数名
//		CSubMenu::DeleteAll
//----------------------------------------------------------------------------------------------------
//  2. 機能
//		全サブメニューを削除
//----------------------------------------------------------------------------------------------------
//  3. パラメータ説明
//		無し
//----------------------------------------------------------------------------------------------------
//  4. 戻り値
//		無し
//----------------------------------------------------------------------------------------------------
//  5. 処理概要
//		全てのサブメニューダイアログを破棄する。
//----------------------------------------------------------------------------------------------------
//  6. 備考
//----------------------------------------------------------------------------------------------------
//  7. 履歴
//		2006.09.01 S.Aizawa(xxx) 新規作成
//*****************************************************************************************************
void CSubMenu::DeleteAll()
{
	CSubMenuDlg *pDialog;

	while (m_arrayDialog.GetSize() != 0) {
		pDialog = (CSubMenuDlg *)m_arrayDialog[0];
		pDialog->DestroyWindow();
		delete pDialog;
		m_arrayDialog.RemoveAt(0);
	}

	m_arrayDialog.RemoveAll();
}

void CSubMenu::EnableMenu()
{
	if (m_pDialog != NULL)
		m_pDialog->EnableMenuButton();
}

